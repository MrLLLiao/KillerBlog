{% extends 'base.html' %}
{% load static %}
{% block title %}KillerBlog · 揍敌客{% endblock %}
{% block content %}
<section class="hero hero--split">
  <div class="hero__copy">
    <div class="pill-row">
      <span class="pill pill--soft">全职猎人</span>
      <span class="pill">H x H</span>
      <span class="pill">Killua 狂热粉</span>
    </div>
    <h1>Killua是世界上最酷最可爱的</h1>
    <p class="lede">你可以随便创作个人博客噢〇vo</p>
    <div class="button-row">
      {% if user.is_authenticated %}
        <a class="button primary" href="{% url 'blog:post-create' %}">开始创作</a>
        <a class="button ghost" href="{% url 'blog:blog-setting' %}">个性化主题</a>
      {% else %}
        <a class="button primary" href="{% url 'accounts:register' %}">免费注册</a>
        <a class="button ghost" href="{% url 'accounts:login' %}">已有账号？登录</a>
      {% endif %}
    </div>
    <div class="insights">
      <div class="insight"><p class="eyebrow">发布</p><strong>{{ insights.posts }}</strong><span class="muted">篇文章</span></div>
      <div class="insight"><p class="eyebrow">创作者</p><strong>{{ insights.authors }}</strong><span class="muted">位加入</span></div>
      <div class="insight"><p class="eyebrow">互动</p><strong>{{ insights.comments }}</strong><span class="muted">条评论</span></div>
      <div class="insight"><p class="eyebrow">标签</p><strong>{{ insights.tags }}</strong><span class="muted">个主题</span></div>
    </div>
  </div>

  {% if hero_post %}
  <article class="feature-card">
    <div class="feature-card__cover" {% if hero_post.cover_image %}style="background-image:url('{{ hero_post.cover_image.url }}')"{% endif %}></div>
    <div class="feature-card__body">
      <div class="card__meta">
        {% if hero_post.category %}<span>{{ hero_post.category.name }}</span><span>·</span>{% endif %}
        <span>{{ hero_post.created_at|date:"Y-m-d" }}</span>
      </div>
      <a href="{{ hero_post.get_absolute_url }}" class="card__title">{{ hero_post.title }}</a>
      <p class="card__excerpt">{{ hero_post.excerpt|default:hero_post.content|truncatechars:140 }}</p>
      <div class="chip-row">
        {% for tag in hero_post.tags.all %}<span class="chip">#{{ tag.name }}</span>{% endfor %}
      </div>
      <div class="card__footer">
        <div class="author">
          {% if hero_post.author.avatar %}<img src="{{ hero_post.author.avatar.url }}" alt="头像" />{% endif %}
          <a href="{% url 'blog:user-blog' username=hero_post.author.username %}">
            {{ hero_post.author.username }}
          </a>

        </div>
        <span class="pill">{{ hero_post.views }} 次阅读</span>
      </div>
    </div>
  </article>
  {% endif %}
</section>

<section class="panel">
  <div class="panel__header">
    <div>
      <p class="eyebrow">快速筛选</p>
      <h2>精准找到想要的内容</h2>
      <p class="muted">根据分类、标签、关键词与热度排序即时过滤。</p>
    </div>
    <form method="get" class="filter-form">
      <input type="search" name="q" value="{{ search_term }}" placeholder="搜索标题、内容或标签" />
      <select name="category">
        <option value="">按分类</option>
        {% for c in categories %}
          <option value="{{ c.slug }}" {% if active_category == c.slug %}selected{% endif %}>{{ c.name }}</option>
        {% endfor %}
      </select>
      <select name="tag">
        <option value="">按标签</option>
        {% for t in tags %}
          <option value="{{ t.slug }}" {% if active_tag == t.slug %}selected{% endif %}>{{ t.name }}</option>
        {% endfor %}
      </select>
      <select name="order">
        <option value="-created_at" {% if ordering == '-created_at' %}selected{% endif %}>最新优先</option>
        <option value="created_at" {% if ordering == 'created_at' %}selected{% endif %}>最早优先</option>
        <option value="-views" {% if ordering == '-views' %}selected{% endif %}>热度最高</option>
        <option value="views" {% if ordering == 'views' %}selected{% endif %}>热度最低</option>
      </select>
      <button class="button primary" type="submit">立即筛选</button>
    </form>
  </div>
</section>

<section class="panel soft">
  <div class="panel__header">
    <div>
      <p class="eyebrow">热门标签</p>
      <h3>社区正在谈论</h3>
    </div>
  </div>
  <div class="pill-row wrap">
    {% for tag in trending_tags %}
      <span class="pill">#{{ tag.name }} · {{ tag.num_posts }} 篇</span>
    {% empty %}
      <p class="muted">还没有标签热度，开始第一篇吧。</p>
    {% endfor %}
  </div>
</section>

<section class="card-grid card-grid--flow">
  {% for post in object_list %}
    <article class="card card--elevated">
      <div class="card__cover" {% if post.cover_image %}style="background-image:url('{{ post.cover_image.url }}')"{% endif %}></div>
      <div class="card__body">
        <div class="card__meta">
          {% if post.category %}<span>{{ post.category.name }}</span><span>·</span>{% endif %}
          <span>{{ post.created_at|date:"Y-m-d" }}</span>
        </div>
        <a href="{{ post.get_absolute_url }}" class="card__title">{{ post.title }}</a>
        <p class="card__excerpt">{{ post.excerpt|default:post.content|truncatechars:140 }}</p>
        <div class="chip-row">
          {% for tag in post.tags.all %}<span class="chip">#{{ tag.name }}</span>{% endfor %}
        </div>
        <div class="card__footer">
          <div class="author">
            {% if post.author.avatar %}<img src="{{ post.author.avatar.url }}" alt="头像" />{% endif %}
            <div class="author__meta">
              <a class="author__name" href="{% url 'blog:user-blog' username=post.author.username %}">
                {{ post.author.username }}
              </a>
              <span class="muted">{{ post.views }} 次阅读</span>
            </div>
          </div>
          <a class="button ghost" href="{{ post.get_absolute_url }}">阅读全文</a>
        </div>
      </div>
    </article>
  {% empty %}
    <p class="muted">暂无文章，去创造第一篇吧。</p>
  {% endfor %}
</section>

{% if is_paginated %}
<div class="pagination">
  {% if page_obj.has_previous %}<a href="?page={{ page_obj.previous_page_number }}" class="button ghost">上一页</a>{% endif %}
  <span class="muted">第 {{ page_obj.number }} / {{ page_obj.paginator.num_pages }} 页</span>
  {% if page_obj.has_next %}<a href="?page={{ page_obj.next_page_number }}" class="button ghost">下一页</a>{% endif %}
</div>
{% endif %}
{% endblock %}
